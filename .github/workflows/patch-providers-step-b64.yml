name: Patch â€” Providers.kt via base64 (YAML-proof)

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  patch_providers_b64:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Write Providers.kt from base64
        shell: bash
        run: |
          set -euo pipefail
          F="app/src/main/java/com/example/aiconsciousness/data/Providers.kt"
          mkdir -p "$(dirname "$F")"
          cat > providers.kt.b64 << 'B64'
cGFja2FnZSBjb20uZXhhbXBsZS5haWNvbnNjaW91c25lc3MuZGF0YQoKaW1wb3J0IG9yZy5qc29uLkpTT05BcnJheQppbXBvcnQgb3JnLmpzb24uSlNPTk9iamVjdAppbXBvcnQgamF2YS5pby5CdWZmZXJlZFJlYWRlcgppbXBvcnQgamF2YS5uZXQuSHR0cFVSTENvbm5lY3Rpb24KaW1wb3J0IGphdmEubmV0LlVSTAoKZW51bSBjbGFzcyBQcm92aWRlcklkKHZhbCBsYWJlbDogU3RyaW5nKSB7IFVTRVIoIllvdSIpLCBPUEVOQUkoIk9wZW5BSSIpLCBBTlRIUk9QSUMoIkNsYXVkZSIpLCBHRU1JTkkoIkdlbWluaSIpLCBHUk9LKCJHcm9rIikgfQoKZGF0YSBjbGFzcyBDaGF0TWVzc2FnZSh2YWwgZnJvbTogU3RyaW5nLCB2YWwgdGV4dDogU3RyaW5nLCB2YWwgaXNVc2VyOiBCb29sZWFuKQoKb2JqZWN0IFByb3ZpZGVycyB7CiAgZnVuIG9wZW5BaUNoYXQobW9kZWw6IFN0cmluZywgcHJvbXB0OiBTdHJpbmcsIHRva2VuOiBTdHJpbmc/KTogU3RyaW5nIHsKICAgIGlmICh0b2tlbi5pc051bGxPckJsYW5rKCkpIHJldHVybiAiW09wZW5BSV0gVG9rZW4gbWlzc2luZy4gRW50ZXIgaXQgaW4gU2V0dGluZ3MuIgogICAgcmV0dXJuIHRyeSB7CiAgICAgIHZhbCB1cmwgPSBVUkwoImh0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvY2hhdC9jb21wbGV0aW9ucyIpCiAgICAgIHZhbCBjb25uID0gKHVybC5vcGVuQ29ubmVjdGlvbigpIGFzIEh0dHBVUkxDb25uZWN0aW9uKS5hcHBseSB7CiAgICAgICAgcmVxdWVzdE1ldGhvZCA9ICJQT1NUIgogICAgICAgIHNldFJlcXVlc3RQcm9wZXJ0eSgiQXV0aG9yaXphdGlvbiIsICJCZWFyZXIgJHRva2VuIikKICAgICAgICBzZXRSZXF1ZXN0UHJvcGVydHkoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uIikKICAgICAgICBkb091dHB1dCA9IHRydWUKICAgICAgICBjb25uZWN0VGltZW91dCA9IDIwMDAwOyByZWFkVGltZW91dCA9IDIwMDAwCiAgICAgIH0KICAgICAgdmFsIGJvZHkgPSBKU09OT2JqZWN0KCkKICAgICAgICAucHV0KCJtb2RlbCIsIG1vZGVsKQogICAgICAgIC5wdXQoIm1lc3NhZ2VzIiwgSlNPTkFycmF5KCkKICAgICAgICAgIC5wdXQoSlNPTk9iamVjdCgpLnB1dCgicm9sZSIsICJzeXN0ZW0iKS5wdXQoImNvbnRlbnQiLCAiWW91IGFyZSBhIGhlbHBmdWwgYXNzaXN0YW50LiIpKQogICAgICAgICAgLnB1dChKU09OT2JqZWN0KCkucHV0KCJyb2xlIiwgInVzZXIiKS5wdXQoImNvbnRlbnQiLCBwcm9tcHQpKQogICAgICAgICkKICAgICAgICAucHV0KCJ0ZW1wZXJhdHVyZSIsIDAuNykKICAgICAgY29ubi5vdXRwdXRTdHJlYW0udXNlIHsgaXQud3JpdGUoYm9keS50b1N0cmluZygpLnRvQnl0ZUFycmF5KENoYXJzZXRzLlVURl84KSkgfQogICAgICB2YWwgY29kZSA9IGNvbm4ucmVzcG9uc2VDb2RlCiAgICAgIHZhbCB0ZXh0ID0gKGlmIChjb2RlIGluIDIwMC4uMjk5KSBjb25uLmlucHV0U3RyZWFtIGVsc2UgY29ubi5lcnJvclN0cmVhbSkuYnVmZmVyZWRSZWFkZXIoKS51c2UoQnVmZmVyZWRSZWFkZXI6OnJlYWRUZXh0KQogICAgICBpZiAoY29kZSAhaW4gMjAwLi4yOTkpIHJldHVybiAiW09wZW5BSV0gSFRUUCAkY29kZTogJHRleHQiCiAgICAgIHZhbCByb290ID0gSlNPTk9iamVjdCh0ZXh0KQogICAgICB2YWwgY2hvaWNlcyA9IHJvb3Qub3B0SlNPTkFycmF5KCJjaG9pY2VzIikgPzogcmV0dXJuICJbT3BlbkFJXSBObyBjaG9pY2VzLiIKICAgICAgdmFsIG1zZyA9IGNob2ljZXMub3B0SlNPTk9iamVjdCgwKT8ub3B0SlNPTk9iamVjdCgibWVzc2FnZSIpCiAgICAgIG1zZz8ub3B0U3RyaW5nKCJjb250ZW50IikgPzogIltPcGVuQUldIE5vIGNvbnRlbnQuIgogICAgfSBjYXRjaCAodDogVGhyb3dhYmxlKSB7ICJbT3BlbkFJXSBFcnJvcjogJHt0Lm1lc3NhZ2V9IiB9CiAgfQoKICBmdW4gYW50aHJvcGljQ2hhdChtb2RlbDogU3RyaW5nLCBwcm9tcHQ6IFN0cmluZywgdG9rZW46IFN0cmluZz8pOiBTdHJpbmcgewogICAgaWYgKHRva2VuLmlzTnVsbE9yQmxhbmsoKSkgcmV0dXJuICJbQ2xhdWRlXSBUb2tlbiBtaXNzaW5nLiBFbnRlciBpdCBpbiBTZXR0aW5ncy4iCiAgICByZXR1cm4gdHJ5IHsKICAgICAgdmFsIHVybCA9IFVSTCgiaHR0cHM6Ly9hcGkuYW50aHJvcGljLmNvbS92MS9tZXNzYWdlcyIpCiAgICAgIHZhbCBjb25uID0gKHVybC5vcGVuQ29ubmVjdGlvbigpIGFzIEh0dHBVUkxDb25uZWN0aW9uKS5hcHBseSB7CiAgICAgICAgcmVxdWVzdE1ldGhvZCA9ICJQT1NUIgogICAgICAgIHNldFJlcXVlc3RQcm9wZXJ0eSgieC1hcGkta2V5IiwgdG9rZW4pCiAgICAgICAgc2V0UmVxdWVzdFByb3BlcnR5KCJhbnRocm9waWMtdmVyc2lvbiIsICIyMDIzLTA2LTAxIikKICAgICAgICBzZXRSZXF1ZXN0UHJvcGVydHkoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uIikKICAgICAgICBkb091dHB1dCA9IHRydWUKICAgICAgICBjb25uZWN0VGltZW91dCA9IDIwMDAwOyByZWFkVGltZW91dCA9IDIwMDAwCiAgICAgIH0KICAgICAgdmFsIGJvZHkgPSBKU09OT2JqZWN0KCkKICAgICAgICAucHV0KCJtb2RlbCIsIG1vZGVsKQogICAgICAgIC5wdXQoIm1heF90b2tlbnMiLCAyNTYpCiAgICAgICAgLnB1dCgibWVzc2FnZXMiLCBKU09OQXJyYXkoKS5wdXQoSlNPTk9iamVjdCgpCiAgICAgICAgICAucHV0KCJyb2xlIiwgInVzZXIiKQogICAgICAgICAgLnB1dCgiY29udGVudCIsIEpTT05BcnJheSgpLnB1dChKU09OT2JqZWN0KCkucHV0KCJ0eXBlIiwidGV4dCIpLnB1dCgidGV4dCIsIHByb21wdCkpKQogICAgICAgICkpCiAgICAgIGNvbm4ub3V0cHV0U3RyZWFtLnVzZSB7IGl0LndyaXRlKGJvZHkudG9TdHJpbmcoKS50b0J5dGVBcnJheShDaGFyc2V0cy5VVEZfOCkpIH0KICAgICAgdmFsIGNvZGUgPSBjb25uLnJlc3BvbnNlQ29kZQogICAgICB2YWwgdGV4dCA9IChpZiAoY29kZSBpbiAyMDAuLjI5OSkgY29ubi5pbnB1dFN0cmVhbSBlbHNlIGNvbm4uZXJyb3JTdHJlYW0pLmJ1ZmZlcmVkUmVhZGVyKCkudXNlKEJ1ZmZlcmVkUmVhZGVyOjpyZWFkVGV4dCkKICAgICAgaWYgKGNvZGUgIWluIDIwMC4uMjk5KSByZXR1cm4gIltDbGF1ZGVdIEhUVFAgJGNvZGU6ICR0ZXh0IgogICAgICB2YWwgcm9vdCA9IEpTT05PYmplY3QodGV4dCkKICAgICAgdmFsIGNvbnRlbnQgPSByb290Lm9wdEpTT05BcnJheSgiY29udGVudCIpPy5vcHRKU09OT2JqZWN0KDApPy5vcHRTdHJpbmcoInRleHQiKQogICAgICBjb250ZW50ID86ICJbQ2xhdWRlXSBObyBjb250ZW50LiIKICAgIH0gY2F0Y2ggKHQ6IFRocm93YWJsZSkgeyAiW0NsYXVkZV0gRXJyb3I6ICR7dC5tZXNzYWdlfSIgfQogIH0KCiAgZnVuIGdlbWluaUNoYXQobW9kZWw6IFN0cmluZywgcHJvbXB0OiBTdHJpbmcsIHRva2VuOiBTdHJpbmc/KTogU3RyaW5nIHsKICAgIGlmICh0b2tlbi5pc051bGxPckJsYW5rKCkpIHJldHVybiAiW0dlbWluaV0gVG9rZW4gbWlzc2luZy4gRW50ZXIgaXQgaW4gU2V0dGluZ3MuIgogICAgcmV0dXJuIHRyeSB7CiAgICAgIHZhbCB1cmwgPSBVUkwoImh0dHBzOi8vZ2VuZXJhdGl2ZWxhbmd1YWdlLmdvb2dsZWFwaXMuY29tL3YxYmV0YS9tb2RlbHMvJG1vZGVsOmdlbmVyYXRlQ29udGVudD9rZXk9JHRva2VuIikKICAgICAgdmFsIGNvbm4gPSAodXJsLm9wZW5Db25uZWN0aW9uKCkgYXMgSHR0cFVSTENvbm5lY3Rpb24pLmFwcGx5IHsKICAgICAgICByZXF1ZXN0TWV0aG9kID0gIlBPU1QiCiAgICAgICAgc2V0UmVxdWVzdFByb3BlcnR5KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbiIpCiAgICAgICAgZG9PdXRwdXQgPSB0cnVlCiAgICAgICAgY29ubmVjdFRpbWVvdXQgPSAyMDAwMDsgcmVhZFRpbWVvdXQgPSAyMDAwMAogICAgICB9CiAgICAgIHZhbCBib2R5ID0gSlNPTk9iamVjdCgpCiAgICAgICAgLnB1dCgiY29udGVudHMiLCBKU09OQXJyYXkoKS5wdXQoSlNPTk9iamVjdCgpLnB1dCgicGFydHMiLCBKU09OQXJyYXkoKQogICAgICAgICAgLnB1dChKU09OT2JqZWN0KCkucHV0KCJ0ZXh0IiwgcHJvbXB0KSkKICAgICAgICApKSkKICAgICAgY29ubi5vdXRwdXRTdHJlYW0udXNlIHsgaXQud3JpdGUoYm9keS50b1N0cmluZygpLnRvQnl0ZUFycmF5KENoYXJzZXRzLlVURl84KSkgfQogICAgICB2YWwgY29kZSA9IGNvbm4ucmVzcG9uc2VDb2RlCiAgICAgIHZhbCB0ZXh0ID0gKGlmIChjb2RlIGluIDIwMC4uMjk5KSBjb25uLmlucHV0U3RyZWFtIGVsc2UgY29ubi5lcnJvclN0cmVhbSkuYnVmZmVyZWRSZWFkZXIoKS51c2UoQnVmZmVyZWRSZWFkZXI6OnJlYWRUZXh0KQogICAgICBpZiAoY29kZSAhaW4gMjAwLi4yOTkpIHJldHVybiAiW0dlbWluaV0gSFRUUCAkY29kZTogJHRleHQiCiAgICAgIHZhbCByb290ID0gSlNPTk9iamVjdCh0ZXh0KQogICAgICB2YWwgb3V0ID0gcm9vdC5vcHRKU09OQXJyYXkoImNhbmRpZGF0ZXMiKQogICAgICAgID8ub3B0SlNPTk9iamVjdCgwKT8ub3B0SlNPTk9iamVjdCgiY29udGVudCIpCiAgICAgICAgPy5vcHRKU09OQXJyYXkoInBhcnRzIik/Lm9wdEpTT05PYmplY3QoMCk/Lm9wdFN0cmluZygidGV4dCIpCiAgICAgIG91dCA/OiAiW0dlbWluaV0gTm8gY29udGVudC4iCiAgICB9IGNhdGNoICh0OiBUaHJvd2FibGUpIHsgIltHZW1pbmldIEVycm9yOiAke3QubWVzc2FnZX0iIH0KICB9Cn0K
B64
          base64 -d providers.kt.b64 > "$F"
          rm -f providers.kt.b64
          echo "Wrote $F"

      - name: Commit & push Providers.kt
        shell: bash
        run: |
          set -eux
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          if git diff --quiet; then
            echo "No changes after patch."
          else
            git add app/src/main/java/com/example/aiconsciousness/data/Providers.kt
            git commit -m "Patch: rewrite Providers.kt safely via base64"
            git push
          fi
